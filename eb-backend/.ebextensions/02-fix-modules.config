files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/02_fix_shared_modules.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      # Log environment for debugging
      echo "Current directory: $(pwd)"
      echo "Node.js version: $(node -v)"
      
      # For the staging environment (during deployment)
      cd /var/app/staging
      
      # Fix shared module paths
      if [ -d "shared" ]; then
        # Create the node_modules/@shared directory
        mkdir -p node_modules/@shared
        
        # Copy shared directory content to node_modules/@shared
        cp -r shared/* node_modules/@shared/
        
        # Create a package.json in node_modules/@shared if it doesn't exist
        if [ ! -f "node_modules/@shared/package.json" ]; then
          echo '{
            "name": "@shared",
            "version": "1.0.0",
            "type": "module"
          }' > node_modules/@shared/package.json
        fi
        
        echo "Successfully set up @shared module in node_modules"
      else
        echo "Warning: shared directory not found"
      fi
      
      exit 0 